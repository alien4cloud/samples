tosca_definitions_version: alien_dsl_1_4_0

metadata:
  template_name: artemis.ais.spark-job
  template_version: 2.1.0-SNAPSHOT
  template_author: alien4cloud

imports:
- tosca-normative-types:1.0.0-ALIEN20
- alien-base-types:2.1.0-SNAPSHOT

node_types:

  artemis.ais.spark-job.nodes.SparkApplication:
    derived_from: org.alien4cloud.nodes.Job
    metadata:
      icon: /images/spark.png
    properties:
      hive_site_url:
        type: string
      main_jar_url:
        type: string
      class_name:
        type: string
      driver_memory:
        type: integer
      executor_memory:
        type: integer
      app_args:
        type: string
    capabilities:
      app_dependency:
        type: org.alien4cloud.demo.spark-jobs.capabilities.SparkApplicationDependency
    requirements:
    - app_dependency:
        capability: org.alien4cloud.demo.spark-jobs.capabilities.SparkApplicationDependency
        relationship: org.alien4cloud.demo.spark-jobs.relationships.SparkAppDependency
        occurrences: [ 0, 1 ]
    interfaces:
      tosca.interfaces.node.lifecycle.Runnable:
        run:
          inputs:
            HIVE_SITE_URL: { get_property: [SELF, hive_site_url] }
            MAIN_JAR_URL: { get_property: [SELF, main_jar_url] }
            MAIN_CLASS: { get_property: [SELF, class_name] }
            DRIVER_MEMORY: { get_property: [SELF, driver_memory] }
            EXECUTOR_MEMORY: { get_property: [SELF, executor_memory] }
            APP_ARGS: { get_property: [SELF, app_args] }
          implementation: scripts/run.sh

capability_types:

  org.alien4cloud.demo.spark-jobs.capabilities.SparkApplicationDependency:
    derived_from: tosca.capabilities.Root

relationship_types:

  org.alien4cloud.demo.spark-jobs.relationships.SparkAppDependency:
    derived_from: tosca.relationships.DependsOn
    valid_target_types: [org.alien4cloud.demo.spark-jobs.capabilities.SparkApplicationDependency]
    interfaces:
      Configure:
        pre_configure_source:
          implementation: scripts/app_connect.sh