tosca_definitions_version: alien_dsl_2_0_0

metadata:
  template_name: artemis.similimages.topologies.SimilimageSearch
  template_version: 2.1.0-SNAPSHOT
  template_author: alien4cloud

description: ""

imports:
  - tosca-normative-types:1.0.0-ALIEN20
  - artemis.hadoop.pub:2.1.0-SNAPSHOT
  - artemis.similimages.containers:2.1.0-SNAPSHOT
  - artemis.elasticsearch.pub:2.1.0-SNAPSHOT
  - artemis.mysql.pub:2.1.0-SNAPSHOT
  - docker-types:2.1.0-SNAPSHOT

topology_template:
  node_templates:
    CR_EliseSearch:
      type: org.alien4cloud.extended.container.types.ContainerRuntime
      requirements:
        - hostedOnContainerDeploymentUnitHost:
            type_requirement: host
            node: DU_EliseSearch
            capability: tosca.capabilities.Container.Docker
            relationship: tosca.relationships.HostedOn
    EliseSearch:
      type: artemis.similimages.containers.nodes.EliseSearch
      properties:
        docker_run_cmd: "/elise/wait-for-db.sh && /elise/scripts/start_elise_search.sh"
        cpu_share: 1.0
        mem_share: "128 MB"
      requirements:
        - connectsToHdfsServiceHttp_endpoint:
            type_requirement: hadoop01
            node: hadoop01
            capability: artemis.hadoop.pub.capabilities.HDFSHttpEndpoint
            relationship: tosca.relationships.ConnectsTo
        - connectsToMysqlDbServiceDb:
            type_requirement: my_sql_search
            node: si_search
            capability: artemis.mysql.pub.capabilities.MysqlDbEndpoint
            relationship: tosca.relationships.ConnectsTo
        - hostedOnContainerRuntimeContainerRuntimeHost:
            type_requirement: host
            node: CR_EliseSearch
            capability: org.alien4cloud.extended.container.capabilities.ApplicationHost
            relationship: org.alien4cloud.extended.container.relationships.HostedOnContainerRuntime
        - connectsToElasticSearchServiceHttp:
            type_requirement: text_se
            node: Text_SE
            capability: artemis.elasticsearch.pub.capabilities.ElasticSearchRestAPI
            relationship: tosca.relationships.ConnectsTo
        - connectsToSiAnnotFaceDb:
            type_requirement: my_sql_annot_faces
            node: si_annot_face
            capability: artemis.mysql.pub.capabilities.MysqlDbEndpoint
            relationship: tosca.relationships.ConnectsTo
      capabilities:
        web_service:
          properties:
            port: 8081
            protocol: tcp
            secure: false
            network_name: PRIVATE
            initiator: source
        scalable:
          properties:
            min_instances: 1
            max_instances: 1
            default_instances: 1
    DU_EliseSearch:
      metadata:
        a4c_edit_x: "-46"
        a4c_edit_y: "-144"
      type: org.alien4cloud.extended.container.types.ContainerDeploymentUnit
      capabilities:
        scalable:
          properties:
            min_instances: 1
            max_instances: 1
            default_instances: 1
    DU_EliseInterface:
      metadata:
        a4c_edit_x: "-384"
        a4c_edit_y: "-28"
      type: org.alien4cloud.extended.container.types.ContainerDeploymentUnit
      capabilities:
        scalable:
          properties:
            min_instances: 1
            max_instances: 1
            default_instances: 1
    CR_EliseInterface:
      type: org.alien4cloud.extended.container.types.ContainerRuntime
      requirements:
        - hostedOnContainerDeploymentUnitHost:
            type_requirement: host
            node: DU_EliseInterface
            capability: tosca.capabilities.Container.Docker
            relationship: tosca.relationships.HostedOn
    EliseInterface:
      type: artemis.similimages.containers.nodes.EliseInterface
      properties:
        docker_run_cmd: "/var/www/initialize_config.sh && apache2-foreground"
        cpu_share: 1.0
        mem_share: "128 MB"
      requirements:
        - connectsToEliseSearchWeb_service:
            type_requirement: elise_search
            node: EliseSearch
            capability: artemis.similimages.containers.capabilities.EliseSearchEndpoint
            relationship: tosca.relationships.ConnectsTo
        - hostedOnContainerRuntimeContainerRuntime2Host:
            type_requirement: host
            node: CR_EliseInterface
            capability: org.alien4cloud.extended.container.capabilities.ApplicationHost
            relationship: org.alien4cloud.extended.container.relationships.HostedOnContainerRuntime
        - connectsToSimInterfaceMySqlDb:
            type_requirement: my_sql_annotface
            node: si_annot_face
            capability: artemis.mysql.pub.capabilities.MysqlDbEndpoint
            relationship: tosca.relationships.ConnectsTo
      capabilities:
        http:
          properties:
            protocol: tcp
            port: 80
            secure: false
            network_name: PRIVATE
            initiator: source
        https:
          properties:
            protocol: tcp
            port: 443
            secure: false
            network_name: PRIVATE
            initiator: source
        scalable:
          properties:
            min_instances: 1
            max_instances: 1
            default_instances: 1
    si_annot_face:
      metadata:
        a4c_edit_x: 355
        a4c_edit_y: 218
      type: artemis.mysql.pub.nodes.MysqlDbService
      capabilities:
        db:
          properties:
            port: 3306
            protocol: tcp
            secure: false
            network_name: PRIVATE
            initiator: source
    si_search:
      metadata:
        a4c_edit_x: 380
        a4c_edit_y: "-42"
      type: artemis.mysql.pub.nodes.MysqlDbService
      capabilities:
        db:
          properties:
            port: 3306
            protocol: tcp
            secure: false
            network_name: PRIVATE
            initiator: source
    Text_SE:
      metadata:
        a4c_edit_x: 381
        a4c_edit_y: 22
      type: artemis.elasticsearch.pub.nodes.ElasticSearchService
      capabilities:
        elasticsearch:
          properties:
            port: 9300
            protocol: tcp
            secure: false
            network_name: PRIVATE
            initiator: source
        http:
          properties:
            port: 9200
            protocol: http
            secure: false
            network_name: PRIVATE
            initiator: source
    hadoop01:
      metadata:
        a4c_edit_x: 381
        a4c_edit_y: 90
      type: artemis.hadoop.pub.nodes.HDFSService
      capabilities:
        hdfs_endpoint:
          properties:
            port: 9000
            protocol: hdfs
            secure: false
            network_name: PRIVATE
            initiator: source
        http_endpoint:
          properties:
            port: 50070
            protocol: http
            secure: false
            network_name: PRIVATE
            initiator: source
